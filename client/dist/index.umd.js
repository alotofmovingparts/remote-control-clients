!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("uuid")):"function"==typeof define&&define.amd?define(["uuid"],t):(e||self).TouchControlClient=t(e.uuid)}(this,function(e){function t(e){return t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(e)}function n(e,t){return n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function i(e,t,u){return i=c()?Reflect.construct:function(e,t,c){var i=[null];i.push.apply(i,t);var u=new(Function.bind.apply(e,i));return c&&n(u,c.prototype),u},i.apply(null,arguments)}function u(e){var c="function"==typeof Map?new Map:void 0;return u=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==c){if(c.has(e))return c.get(e);c.set(e,u)}function u(){return i(e,arguments,t(this).constructor)}return u.prototype=Object.create(e.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),n(u,e)},u(e)}var r;return function(e){e.Connecting="CONNECTING",e.Connected="CONNECTED",e.Disconnected="DISCONNECTED"}(r||(r={})),/*#__PURE__*/function(t){var c,i;function u(e){var n;return(n=t.call(this)||this).url=void 0,n.ws=void 0,n.state=void 0,n._callbacks=void 0,n.url=e,n.state=r.Disconnected,n._callbacks={},n}i=t,(c=u).prototype=Object.create(i.prototype),c.prototype.constructor=c,n(c,i);var o=u.prototype;return o.connect=function(t){var n=this;this.state=r.Connecting,this.ws=new WebSocket(this.url),this.ws.onopen=function(c){var i,u=e.v4();t&&(n._callbacks[u]=t),null==(i=n.ws)||i.send(JSON.stringify({type:"connect",uuid:u}))},this.ws.onclose=function(e){n.state=r.Disconnected,n.dispatchEvent(new CustomEvent("disconnect"))},this.ws.onmessage=function(e){var t,c=JSON.parse(e.data);switch(c.type){case"set_response":if((t=c).uuid in n._callbacks){var i=n._callbacks[t.uuid];delete n._callbacks[t.uuid],i(null)}break;case"read_response":if((t=c).uuid in n._callbacks){var u=n._callbacks[t.uuid];delete n._callbacks[t.uuid];var o=Object.keys(t.values);u(null,o.length>1?t.values:t.values[o[0]])}break;case"clients_response":if((t=c).uuid in n._callbacks){var s=n._callbacks[t.uuid];delete n._callbacks[t.uuid],s(null,t.clients)}break;case"connect_response":if(t=c,n.state=r.Connected,t.uuid in n._callbacks){var a=n._callbacks[t.uuid];delete n._callbacks[t.uuid],a(null,t.initialValues,t.clients)}n.dispatchEvent(new CustomEvent("connect",{detail:t}));break;case"update":t=c,n.dispatchEvent(new CustomEvent("update",{detail:t}));break;case"error":if((t=c).uuid&&t.uuid in n._callbacks){var l=n._callbacks[t.uuid];delete n._callbacks[t.uuid],l(new Error(t.message))}n.dispatchEvent(new CustomEvent("error",{detail:t}))}},this.ws.onerror=function(e){var t={type:"error",message:String(e)};n.dispatchEvent(new CustomEvent("error",{detail:t}))}},o.set=function(t,n,c){var i,u=e.v4();c&&(this._callbacks[u]=c),null==(i=this.ws)||i.send(JSON.stringify({type:"set",values:{value:n},uuid:u}))},o.read=function(t,n){var c,i=e.v4();n&&(this._callbacks[i]=n),null==(c=this.ws)||c.send(JSON.stringify({type:"read",names:t?[t]:[],uuid:i}))},o.clients=function(t){var n,c=e.v4();t&&(this._callbacks[c]=t),null==(n=this.ws)||n.send(JSON.stringify({type:"clients",uuid:c}))},o.disconnect=function(){var e;null==(e=this.ws)||e.close()},u}(/*#__PURE__*/u(EventTarget))});
//# sourceMappingURL=index.umd.js.map
