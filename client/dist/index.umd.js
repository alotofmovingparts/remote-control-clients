!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t||self).TouchControlClient=e()}(this,function(){function t(e){return t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},t(e)}function e(t,n){return e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},e(t,n)}function n(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function o(t,r,i){return o=n()?Reflect.construct:function(t,n,o){var r=[null];r.push.apply(r,n);var i=new(Function.bind.apply(t,r));return o&&e(i,o.prototype),i},o.apply(null,arguments)}function r(n){var i="function"==typeof Map?new Map:void 0;return r=function(n){if(null===n||-1===Function.toString.call(n).indexOf("[native code]"))return n;if("function"!=typeof n)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(n))return i.get(n);i.set(n,r)}function r(){return o(n,arguments,t(this).constructor)}return r.prototype=Object.create(n.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),e(r,n)},r(n)}var i,c=new Uint8Array(16);function u(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(c)}var s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function a(t){return"string"==typeof t&&s.test(t)}for(var l,f=[],d=0;d<256;++d)f.push((d+256).toString(16).substr(1));function p(t,e,n){var o=(t=t||{}).random||(t.rng||u)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e){n=n||0;for(var r=0;r<16;++r)e[n+r]=o[r];return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(f[t[e+0]]+f[t[e+1]]+f[t[e+2]]+f[t[e+3]]+"-"+f[t[e+4]]+f[t[e+5]]+"-"+f[t[e+6]]+f[t[e+7]]+"-"+f[t[e+8]]+f[t[e+9]]+"-"+f[t[e+10]]+f[t[e+11]]+f[t[e+12]]+f[t[e+13]]+f[t[e+14]]+f[t[e+15]]).toLowerCase();if(!a(n))throw TypeError("Stringified UUID is invalid");return n}(o)}return function(t){t.Connecting="CONNECTING",t.Connected="CONNECTED",t.Disconnected="DISCONNECTED"}(l||(l={})),/*#__PURE__*/function(t){var n,o;function r(e){var n;return(n=t.call(this)||this).url=void 0,n.ws=void 0,n.state=void 0,n._callbacks=void 0,n.url=e,n.state=l.Disconnected,n._callbacks={},n}o=t,(n=r).prototype=Object.create(o.prototype),n.prototype.constructor=n,e(n,o);var i=r.prototype;return i.connect=function(t){var e=this;this.state=l.Connecting,this.ws=new WebSocket(this.url),this.ws.onopen=function(n){var o,r=p();t&&(e._callbacks[r]=t),null==(o=e.ws)||o.send(JSON.stringify({type:"connect",uuid:r}))},this.ws.onclose=function(t){e.state=l.Disconnected,e.dispatchEvent(new CustomEvent("disconnect"))},this.ws.onmessage=function(t){var n,o=JSON.parse(t.data);switch(console.log(o.type),o.type){case"set_response":if((n=o).uuid in e._callbacks){var r=e._callbacks[n.uuid];delete e._callbacks[n.uuid],r(null)}break;case"read_response":if((n=o).uuid in e._callbacks){var i=e._callbacks[n.uuid];delete e._callbacks[n.uuid];var c=Object.keys(n.values);i(null,c.length>1?n.values:n.values[c[0]])}break;case"clients_response":if((n=o).uuid in e._callbacks){var u=e._callbacks[n.uuid];delete e._callbacks[n.uuid],u(null,n.clients)}break;case"connect_response":if(console.log("connect response"),n=o,e.state=l.Connected,console.log(n.uuid,e._callbacks,n.uuid in e._callbacks),n.uuid in e._callbacks){var s=e._callbacks[n.uuid];delete e._callbacks[n.uuid],s(null,n.initialValues,n.clients)}e.dispatchEvent(new CustomEvent("connect",{detail:n}));break;case"update":n=o,e.dispatchEvent(new CustomEvent("update",{detail:n}));break;case"error":if((n=o).uuid&&n.uuid in e._callbacks){var a=e._callbacks[n.uuid];delete e._callbacks[n.uuid],a(new Error(n.message))}e.dispatchEvent(new CustomEvent("error",{detail:n}))}},this.ws.onerror=function(t){var n={type:"error",message:String(t)};e.dispatchEvent(new CustomEvent("error",{detail:n}))}},i.set=function(t,e,n){var o,r,i=p();n&&(this._callbacks[i]=n);var c={type:"set",values:(o={},o[t]=String(e),o),uuid:i};null==(r=this.ws)||r.send(JSON.stringify(c))},i.read=function(t,e){var n,o=p();e&&(this._callbacks[o]=e),null==(n=this.ws)||n.send(JSON.stringify({type:"read",names:t?[t]:[],uuid:o}))},i.clients=function(t){var e,n=p();t&&(this._callbacks[n]=t),null==(e=this.ws)||e.send(JSON.stringify({type:"clients",uuid:n}))},i.disconnect=function(){var t;null==(t=this.ws)||t.close()},r}(/*#__PURE__*/r(EventTarget))});
//# sourceMappingURL=index.umd.js.map
