import{v4 as t}from"uuid";function e(t){return e=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},e(t)}function n(t,e){return n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(t,e)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function r(t,e,i){return r=c()?Reflect.construct:function(t,e,c){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return c&&n(i,c.prototype),i},r.apply(null,arguments)}function i(t){var c="function"==typeof Map?new Map:void 0;return i=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==c){if(c.has(t))return c.get(t);c.set(t,i)}function i(){return r(t,arguments,e(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),n(i,t)},i(t)}var s;!function(t){t.Connecting="CONNECTING",t.Connected="CONNECTED",t.Disconnected="DISCONNECTED"}(s||(s={}));var u=/*#__PURE__*/function(e){var c,r;function i(t){var n;return(n=e.call(this)||this).url=void 0,n.ws=void 0,n.state=void 0,n._callbacks=void 0,n.url=t,n.state=s.Disconnected,n._callbacks={},n}r=e,(c=i).prototype=Object.create(r.prototype),c.prototype.constructor=c,n(c,r);var u=i.prototype;return u.connect=function(e){var n=this;this.state=s.Connecting,this.ws=new WebSocket(this.url),this.ws.onopen=function(c){var r,i=t();e&&(n._callbacks[i]=e),null==(r=n.ws)||r.send(JSON.stringify({type:"connect",uuid:i}))},this.ws.onclose=function(t){n.state=s.Disconnected,n.dispatchEvent(new CustomEvent("disconnect"))},this.ws.onmessage=function(t){var e,c=JSON.parse(t.data);switch(c.type){case"set_response":if((e=c).uuid in n._callbacks){var r=n._callbacks[e.uuid];delete n._callbacks[e.uuid],r(null)}break;case"read_response":if((e=c).uuid in n._callbacks){var i=n._callbacks[e.uuid];delete n._callbacks[e.uuid];var u=Object.keys(e.values);i(null,u.length>1?e.values:e.values[u[0]])}break;case"clients_response":if((e=c).uuid in n._callbacks){var a=n._callbacks[e.uuid];delete n._callbacks[e.uuid],a(null,e.clients)}break;case"connect_response":if(e=c,n.state=s.Connected,e.uuid in n._callbacks){var o=n._callbacks[e.uuid];delete n._callbacks[e.uuid],o(null,e.initialValues,e.clients)}n.dispatchEvent(new CustomEvent("connect",{detail:e}));break;case"update":e=c,n.dispatchEvent(new CustomEvent("update",{detail:e}));break;case"error":if((e=c).uuid&&e.uuid in n._callbacks){var l=n._callbacks[e.uuid];delete n._callbacks[e.uuid],l(new Error(e.message))}n.dispatchEvent(new CustomEvent("error",{detail:e}))}},this.ws.onerror=function(t){var e={type:"error",message:String(t)};n.dispatchEvent(new CustomEvent("error",{detail:e}))}},u.set=function(e,n,c){var r,i=t();c&&(this._callbacks[i]=c),null==(r=this.ws)||r.send(JSON.stringify({type:"set",values:{value:n},uuid:i}))},u.read=function(e,n){var c,r=t();n&&(this._callbacks[r]=n),null==(c=this.ws)||c.send(JSON.stringify({type:"read",names:e?[e]:[],uuid:r}))},u.clients=function(e){var n,c=t();e&&(this._callbacks[c]=e),null==(n=this.ws)||n.send(JSON.stringify({type:"clients",uuid:c}))},u.disconnect=function(){var t;null==(t=this.ws)||t.close()},i}(/*#__PURE__*/i(EventTarget));export{u as default};
//# sourceMappingURL=index.module.js.map
