var t,e=require("uuid");function n(t){return n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(t)}function c(t,e){return c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},c(t,e)}function r(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function i(t,e,n){return i=r()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&c(i,n.prototype),i},i.apply(null,arguments)}function u(t){var e="function"==typeof Map?new Map:void 0;return u=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return i(t,arguments,n(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),c(r,t)},u(t)}!function(t){t.Connecting="CONNECTING",t.Connected="CONNECTED",t.Disconnected="DISCONNECTED"}(t||(t={}));var s=/*#__PURE__*/function(n){var r,i;function u(e){var c;return(c=n.call(this)||this).url=void 0,c.ws=void 0,c.state=void 0,c._callbacks=void 0,c.url=e,c.state=t.Disconnected,c._callbacks={},c}i=n,(r=u).prototype=Object.create(i.prototype),r.prototype.constructor=r,c(r,i);var s=u.prototype;return s.connect=function(n){var c=this;this.state=t.Connecting,this.ws=new WebSocket(this.url),this.ws.onopen=function(t){var r,i=e.v4();n&&(c._callbacks[i]=n),null==(r=c.ws)||r.send(JSON.stringify({type:"connect",uuid:i}))},this.ws.onclose=function(e){c.state=t.Disconnected,c.dispatchEvent(new CustomEvent("disconnect"))},this.ws.onmessage=function(e){var n,r=JSON.parse(e.data);switch(r.type){case"set_response":if((n=r).uuid in c._callbacks){var i=c._callbacks[n.uuid];delete c._callbacks[n.uuid],i(null)}break;case"read_response":if((n=r).uuid in c._callbacks){var u=c._callbacks[n.uuid];delete c._callbacks[n.uuid];var s=Object.keys(n.values);u(null,s.length>1?n.values:n.values[s[0]])}break;case"clients_response":if((n=r).uuid in c._callbacks){var a=c._callbacks[n.uuid];delete c._callbacks[n.uuid],a(null,n.clients)}break;case"connect_response":if(n=r,c.state=t.Connected,n.uuid in c._callbacks){var o=c._callbacks[n.uuid];delete c._callbacks[n.uuid],o(null,n.initialValues,n.clients)}c.dispatchEvent(new CustomEvent("connect",{detail:n}));break;case"update":n=r,c.dispatchEvent(new CustomEvent("update",{detail:n}));break;case"error":if((n=r).uuid&&n.uuid in c._callbacks){var l=c._callbacks[n.uuid];delete c._callbacks[n.uuid],l(new Error(n.message))}c.dispatchEvent(new CustomEvent("error",{detail:n}))}},this.ws.onerror=function(t){var e={type:"error",message:String(t)};c.dispatchEvent(new CustomEvent("error",{detail:e}))}},s.set=function(t,n,c){var r,i=e.v4();c&&(this._callbacks[i]=c),null==(r=this.ws)||r.send(JSON.stringify({type:"set",values:{value:n},uuid:i}))},s.read=function(t,n){var c,r=e.v4();n&&(this._callbacks[r]=n),null==(c=this.ws)||c.send(JSON.stringify({type:"read",names:t?[t]:[],uuid:r}))},s.clients=function(t){var n,c=e.v4();t&&(this._callbacks[c]=t),null==(n=this.ws)||n.send(JSON.stringify({type:"clients",uuid:c}))},s.disconnect=function(){var t;null==(t=this.ws)||t.close()},u}(/*#__PURE__*/u(EventTarget));module.exports=s;
//# sourceMappingURL=index.cjs.map
